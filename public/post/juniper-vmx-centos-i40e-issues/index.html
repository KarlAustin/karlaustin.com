<!DOCTYPE HTML>

<html>
    <head>
        
            
                <title>Juniper vMX CentOS i40e Driver Issues</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.33" />
        


        
            <meta name="author" content="Karl Austin">
        
        
            <meta name="description" content="A known issue with the Juniper supplied i40e NIC driver stops installation on CentOS">
        

        <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Juniper vMX CentOS i40e Driver Issues"/>
<meta name="twitter:description" content="A known issue with the Juniper supplied i40e NIC driver stops installation on CentOS"/>
<meta name="twitter:site" content="@karlaustin"/>

        <meta property="og:title" content="Juniper vMX CentOS i40e Driver Issues" />
<meta property="og:description" content="A known issue with the Juniper supplied i40e NIC driver stops installation on CentOS" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://karlaustin.com/post/juniper-vmx-centos-i40e-issues/" />



<meta property="article:published_time" content="2018-01-19T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2018-01-19T00:00:00&#43;00:00"/>











        
<meta itemprop="name" content="Juniper vMX CentOS i40e Driver Issues">
<meta itemprop="description" content="A known issue with the Juniper supplied i40e NIC driver stops installation on CentOS">


<meta itemprop="datePublished" content="2018-01-19T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-01-19T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="405">



<meta itemprop="keywords" content="juniper,vmx,internet," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/add-on.css">
        

        

      
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-75661737-1', 'auto');
ga('send', 'pageview');
</script>

    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="/">Karl Austin</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/post">
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="/categories">
                            <i class="">&nbsp;</i>Categories
                    </a>
                </li>
            
                <li>
                    <a href="/about">
                            <i class="">&nbsp;</i>About
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://karlaustin.com/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://karlaustin.com/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/post">
                            <h3>
                                <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            <h3>
                                <i class="">&nbsp;</i>Categories
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about">
                            <h3>
                                <i class="">&nbsp;</i>About
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section id="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/juniper-vmx-centos-i40e-issues/">Juniper vMX CentOS i40e Driver Issues</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-01-19'>
                                    January 19, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/negotiating-with-a-threenager/">Negotiating With A Threenager</a></h3>
                                
                                <time class="published" datetime=
                                    '2017-03-11'>
                                    March 11, 2017</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            /post/
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            


<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fkarlaustin.com%2fpost%2fjuniper-vmx-centos-i40e-issues%2f&text=Juniper%20vMX%20CentOS%20i40e%20Driver%20Issues&via=karlaustin" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>


<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fkarlaustin.com%2fpost%2fjuniper-vmx-centos-i40e-issues%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>


<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fkarlaustin.com%2fpost%2fjuniper-vmx-centos-i40e-issues%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>


<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fkarlaustin.com%2fpost%2fjuniper-vmx-centos-i40e-issues%2f&title=Juniper%20vMX%20CentOS%20i40e%20Driver%20Issues" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>


<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fkarlaustin.com%2fpost%2fjuniper-vmx-centos-i40e-issues%2f&title=Juniper%20vMX%20CentOS%20i40e%20Driver%20Issues" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>


<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fkarlaustin.com%2fpost%2fjuniper-vmx-centos-i40e-issues%2f&title=Juniper%20vMX%20CentOS%20i40e%20Driver%20Issues" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>


<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fkarlaustin.com%2fpost%2fjuniper-vmx-centos-i40e-issues%2f&description=Juniper%20vMX%20CentOS%20i40e%20Driver%20Issues" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>


<li>
  <a href="mailto:?subject=Check out this post by Karl%20Austin&body=https%3a%2f%2fkarlaustin.com%2fpost%2fjuniper-vmx-centos-i40e-issues%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>

        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="/post/juniper-vmx-centos-i40e-issues/">Juniper vMX CentOS i40e Driver Issues</a></h1>
            
        
        
            <p>A known issue with the Juniper supplied i40e NIC driver stops installation on CentOS</p>
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2018-01-19'>
            January 19, 2018</time>
        <span class="author">Karl Austin</span>
        
            <p>2 minute read</p>
        
        
    </div>
</header>


  

  

  <div id="content">
    

<h1 id="vmx-nice-if-you-can-make-it-work">vMX - Nice if you can make it work</h1>

<p>I like Juniper&rsquo;s vMX product, I like JunOS and vMX makes it much more affordable to run inside your network.</p>

<p>What I don&rsquo;t like is the rather sketchy documentation that gives the impression they&rsquo;d rather you don&rsquo;t run vMX.  It&rsquo;s clear that Ubuntu is their primary platform along with VMware now.  They list support for Redhat and CentOS, but with CentOS at least there are some issues that the documentation doesn&rsquo;t cover.</p>

<h1 id="the-i40e-showstopper">The i40e Showstopper</h1>

<p>If you want to use Intel i40e NICs, which at this moment in time means Intel X710 and XL710 for your vMX and you&rsquo;re running CentOS then you&rsquo;re going to hit an issue with everything up to vMX 17.4 (and possibly higher).</p>

<pre><code>Check I40E drivers................................
[Command] cd /usr/local/vmx/live/drivers/i40e-1.3.46/src

[Command] rm -f i40e.ko

[Command] make install
make[1]: Entering directory `/usr/src/kernels/3.10.0-327.el7.x86_64'
CC [M]  /usr/local/vmx/live/drivers/i40e-1.3.46/src/i40e/i40e_main.o
/usr/local/vmx/live/drivers/i40e-1.3.46/src/i40e/i40e_main.c: In function ‘i40e_ndo_bridge_getlink’:
/usr/local/vmx/live/drivers/i40e-1.3.46/src/i40e/i40e_main.c:9086:2: error: too few arguments to function ‘ndo_dflt_bridge_getlink’
return ndo_dflt_bridge_getlink(skb, pid, seq, dev, veb-&gt;bridge_mode);
^
In file included from include/net/dst.h:13:0,
from include/net/sock.h:68,
from include/linux/tcp.h:23,
from include/net/tcp.h:24,
from /usr/local/vmx/live/drivers/i40e-1.3.46/src/i40e/i40e.h:30,
from /usr/local/vmx/live/drivers/i40e-1.3.46/src/i40e/i40e_main.c:28:
include/linux/rtnetlink.h:87:12: note: declared here
extern int ndo_dflt_bridge_getlink(struct sk_buff *skb, u32 pid, u32 seq,
^
/usr/local/vmx/live/drivers/i40e-1.3.46/src/i40e/i40e_main.c:9088:1: warning: control reaches end of non-void function [-Wreturn-type]
}
^
make[2]: *** [/usr/local/vmx/live/drivers/i40e-1.3.46/src/i40e/i40e_main.o] Error 1
make[1]: *** [_module_/usr/local/vmx/live/drivers/i40e-1.3.46/src/i40e] Error 2
make[1]: Leaving directory `/usr/src/kernels/3.10.0-327.el7.x86_64'
make: *** [i40e/i40e.ko] Error 2
[Failed]
</code></pre>

<p>The first thing you might think to do is go and fetch the i40e drivers from the Intel site - <strong>don&rsquo;t</strong> do that, your router won&rsquo;t work properly.  The i40e drivers are modified by Juniper, hence why they ship their own with vMX.</p>

<h1 id="the-solution">The Solution</h1>

<p>Fortunately the solution is pretty trivial, annoyingly so.</p>

<p>Open up:
<code>drivers/i40e-1.3.46/src/i40e/kcompat.h&lt;</code></p>

<p>Search for:
<code>#define NDO_DFLT_BRIDGE_GETLINK_HAS_BRFLAGS</code></p>

<p>Add the following on the line after:
<code>#define NDO_BRIDGE_GETLINK_HAS_FILTER_MASK_PARAM</code></p>

<p>Re-run your install and it should happily compile the i40e drivers for you.</p>

<h1 id="questions">Questions</h1>

<p>You&rsquo;ll probably then do like I did, and wonder why on Earth Juniper didn&rsquo;t just apply a patch to the driver when it detects i40e NICs in a CentOS system if this is a known issue.  The only answer I have for that is, <em>router vendors</em>.</p>

<p>You might also ask why the documentation doesn&rsquo;t mention it as well, as following Juniper&rsquo;s CentOS install guide it&rsquo;s impossible to get vMX up and running; Again, I have no answer for that or why other items are wrong.</p>

<p>It&rsquo;s almost like they don&rsquo;t want you to use it isn&rsquo;t it?</p>

  </div>

  <footer>
    <ul class="stats">
    
        

        
        
            <li>
                
                
                    

                    

                    

                    
                        Category
                    
                
            </li>
        
    

    
    
        <li><a href='/categoriesinternet'>Internet</a></li>
    
</ul>

  </footer>

</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "karlaustin" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>


<ul class="actions pagination">
    
        <li><a href="/post/negotiating-with-a-threenager/"
                class="button big previous">Negotiating With A Threenager</a></li>
    

    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='/'><img src="/img/main/logo-150.jpg" class="intro-circle" width="" alt="Me: Karl Austin" /></a>
      
    
    
      <header>
        <h2>Me &amp; Life</h2>
        <p>Family, projects, passions and life in general</p>
      </header>
    
    
      <ul class="icons">
        
        
  <li><a href="//github.com/karlaustin" target="_blank" title="GitHub" class="fa fa-github"></a></li>















  <li><a href="//flickr.com/photos/21847971@N07" target="_blank" title="Flickr" class="fa fa-flickr"></a></li>



















  <li><a href="//facebook.com/karlpaustin" target="_blank" title="Facebook" class="fa fa-facebook"></a></li>





















  <li><a href="//instagram.com/karlaustin" target="_blank" title="Instagram" class="fa fa-instagram"></a></li>





  <li><a href="//twitter.com/karlaustin" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>














      </ul>
    
  </section>

  
  <section id="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/juniper-vmx-centos-i40e-issues/">Juniper vMX CentOS i40e Driver Issues</a>
              </h3>
              
              <time class="published" datetime='2018-01-19'>
                January 19, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/negotiating-with-a-threenager/">Negotiating With A Threenager</a>
              </h3>
              
              <time class="published" datetime='2017-03-11'>
                March 11, 2017
              </time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            /post/
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  
  
    <section id="categories">
      <header>
        <h3>
          <a href="/categories/">Categories</a>
        </h3>
      </header>
        
          
        

        
        <p>
          <article>
            <header>
              
                <a href="/categories/internet/">Internet</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/photography/">Photography</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/websites/">Websites</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/business/">Business</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/life/">Life</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
    </section>
  

  
  
    <section id="mini-bio">
      <h3>About</h1>
      <p>I'm Karl Austin, I live in Whitwell Derbyshire with my wife Karen and our son George.  I co-own KDA Web Services, we provide web hosting.  I also run Ilumia Images, a photography business as well as getting involved with community groups and events.</p>
      <a href="/about/" class="button">Learn More</a>
    </section>
  

  
  <section id="footer">
    
      <ul class="icons">
        
        
  <li><a href="//github.com/karlaustin" target="_blank" title="GitHub" class="fa fa-github"></a></li>















  <li><a href="//flickr.com/photos/21847971@N07" target="_blank" title="Flickr" class="fa fa-flickr"></a></li>



















  <li><a href="//facebook.com/karlpaustin" target="_blank" title="Facebook" class="fa fa-facebook"></a></li>





















  <li><a href="//instagram.com/karlaustin" target="_blank" title="Instagram" class="fa fa-instagram"></a></li>





  <li><a href="//twitter.com/karlaustin" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>














      </ul>
    
    <p class="copyright">
      
        &copy; 2018
        
          Me &amp; Life
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
      <script src="/js/backToTop.js"></script>
    

    

    
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

